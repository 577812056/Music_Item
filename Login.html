<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>用户登录</title>
	<!-- 引入样式 -->
	<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
	<style>
		body {
			background-color: #F2F6FC;

		}

		.avatar-uploader .el-upload {
			border: 1px dashed #d9d9d9;
			border-radius: 6px;
			cursor: pointer;
			position: relative;
			overflow: hidden;
		}

		.avatar-uploader .el-upload:hover {
			border-color: #409EFF;
		}

		.avatar-uploader-icon {
			font-size: 28px;
			color: #8c939d;
			width: 178px;
			height: 178px;
			line-height: 178px;
			text-align: center;
		}

		.avatar {
			width: 178px;
			height: 178px;
			display: block;
		}

		audio {
			display: none;
		}

		.bg-balloon {
			width: 80px;
			height: 125px;
			background: url(./img/气球.png) no-repeat;
			background-size: 80px;
			position: fixed;
			top: 70%;
			left: 82%;
		}

		#paper_plane {
			width: 300px;
			height: 200px;
			background: url(./img/纸飞机.png) no-repeat;
			background-size: 300px;
			position: fixed;
			top: 63%;
			left: 45%;
		}

		#bg_girl {
			width: 300px;
			height: 300px;
			background: url(./img/女孩.gif) no-repeat;
			background-size: 300px;
			position: fixed;
			top: 48%;
			left: 14%;
		}

		#loginBody {
			width: 100%;
			position: fixed;
			top: 20%;
			left: 0%;
		}

		#div_boo {
			position: fixed;
			top: 13%;
			left: 85%;
		}
	</style>

	<script type="text/javascript" src="js/jquery-2.1.0.js"></script>
	<script type="text/javascript" src="js/vue.js"></script>
	<script src="https://unpkg.com/element-ui/lib/index.js"></script>

</head>
<div id="app">
	<div @mouseenter="switchover1()" @mouseleave="switchover2()" id="div_boo">
		<el-button :circle="!is_showTxt" size="medium" :round="is_showTxt" @click="switchover()" icon="el-icon-user"
			id="boo">
		</el-button>
	</div>

	<audio id="music" preload="auto" controls="controls" src="./mp3/姜创钢琴 - 初见（翻自 余昭源、叶里）.mp3">
	</audio>
	<div id="loginBody">
		<el-row>
			<el-col :span="4" :offset="11">
				<transition name="el-zoom-in-center">
					<img src="./img/音乐 (3).png" v-show="show2" @click="imgShow()" alt="简乐" title="简乐" />
				</transition>
			</el-col>
		</el-row>
		<el-row>
			<el-col :span="6" :offset="9">
				<div class="LoginBody">
					<el-row style="margin-top:20px;">
						<el-col :span="21">
							<el-input v-model="loginDate.number" class="number" placeholder="账号"></el-input>
						</el-col>
						<el-col :span="2" :offset="1">
							<el-button @click="numberTypeClick()" :icon="numberType_icon" circle></el-button>
						</el-col>
					</el-row>
					<el-row style="margin-top:20px;" v-show="!is_login">
						<el-col :span="21">
							<el-input v-model="enrollDate.code" class="code" placeholder="验证码"></el-input>
						</el-col>
						<el-col :span="2" :offset="1">
							<el-button @click="codeClick()" id="pushCode" icon="el-icon-chat-line-square" circle>
							</el-button>
						</el-col>
					</el-row>
					<el-row style="margin-top:20px;">
						<el-col :span="21">
							<el-input type="password" v-model="loginDate.password" class="password" placeholder="密码"></el-input>
						</el-col>
						<el-col :span="2" :offset="1">
							<el-button @click="loginTypeClick()" :icon="loginType_icon" circle></el-button>
						</el-col>
					</el-row>
					<el-row style="margin-top:20px;">
						<el-col :span="24">
							<el-button @click="login()" style="width:100%;">{{is_login?"登录":"注册"}}</el-button>
						</el-col>
					</el-row>
				</div>
			</el-col>
		</el-row>
	</div>
	<div id="paper_plane"></div>
	<el-popover
    placement="top-start"
    title=""
    width="200"
    trigger="hover"
    content="不停追寻着 那是什么?">
	<div id="bg_girl" slot="reference"></div>
  </el-popover>
</div>

<body>
</body>
<script src="./js/Http.js" type="text/javascript"></script>
<script type="text/javascript">


	// $(".bg-balloon").hover(function(){
	// 	alert("1");
	// },function(){});

	function balloons(e) {
		document.addEventListener("mousemove", function (e) {
			console.log(vuex.pageX)
			vuex.pageX = e.pageX;
			console.log(vuex.pageY)
			vuex.pageY = e.pageY;
		});

	}

	var vuex = new Vue({
		el: '#app',
		data: {
			loginDate: {
				number: "",
				numberType: 1,
				loginType: 0,
				password: ""
			},
			enrollDate: {
				number: "",
				numberType: 1,
				loginType: 0,
				code: "",
				password: ""
			},
			pageX: 0,
			pageY: 0,
			codeDelay: 60,
			imageUrl: "",
			show2: true,
			is_showTxt: false,
			txt: "",
			balloon: true,
			numberType_icon: "el-icon-message",
			loginType_icon: "el-icon-lock",
			is_login: true,
		},
		methods: {
			switchover2() { //功能切换input
				let i;
				if (this.is_login) {
					i = `<i class="el-icon-user"></i>`;
				} else {
					i = `<i class="el-icon-edit"></i>`;
				}
				this.is_showTxt = false;
				$("#boo").html(i);
			},
			switchover1() { //功能切换out
				let i;
				let txt = "";
				if (this.is_login) {
					i = `<i class="el-icon-user"></i>`;
					txt = "登录";
				} else {
					i = `<i class="el-icon-edit"></i>`;
					txt = "注册";
				}
				this.is_showTxt = true;
				$("#boo").html(i + "&nbsp;" + txt);
			},
			switchover() { //功能切换 登录=注册
				this.is_login = !this.is_login;
				this.switchover1();
			},
			balloonClick() { //气球动画实现
				let _this = this;
				_this.balloon = false;
				for (let i = 0; i < 5; i++) {
					$("body").append(`<div class="bg-balloon" onclick="balloons(this)"></div>`);
				}
				$.each($(".bg-balloon"), function (i, a) {
					let x = Math.ceil(Math.random() * 10) * 10;
					let y = (Math.ceil(Math.random() * 10) * 3) + 70;
					$(a).attr("x", x);
					$(a).attr("y", y)
					$(a).css("top", y + "%");
					$(a).css("left", x + "%");
				});
				let time = setInterval(function () {
					$.each($(".bg-balloon"), function (i, a) {
						let y = $(a).attr("y");
						$(a).attr("y", --y);
						$(a).css("top", --y + "%");
						if (i == 2 && y <= -25) {
							$(".bg-balloon").remove();
							_this.balloon = true;
							clearInterval(time);

						}

					});
				}, 140);
			},
			imgShow() { //开启/暂停背景音乐
				let _this = this;

				//播放背景音乐
				let uploadMusic = $("#music")[0];
				if (uploadMusic.paused) {
					/*如果已经暂停*/
					uploadMusic.play();/*播放*/
					_this.$notify({
						title: '温馨提示',
						message: '你打开了背景音乐',
					});
				} else {
					uploadMusic.pause();/*暂停*/
					_this.$notify({
						title: '温馨提示',
						message: '你暂停了背景音乐',
					});
				}

				_this.show2 = !_this.show2;
				setTimeout(function () {
					_this.show2 = !_this.show2;
				}, 400)
			},
			codeClick() { //发送注册验证码
				let _this = this;
				if (!this.codeVerify())
					return;
				if (this.codeDelay != 60)
					return;
				//发送验证码
				this.$message({
					message: '系统发送了一条验证码 注意查收',
					type: 'success'
				});
				let codeTime = setInterval(function () {
					_this.codeDelay -= 1;
					if (_this.codeDelay <= 0) {
						$("#pushCode").html(`<i class="el-icon-chat-line-square"></i>`);
						_this.codeDelay = 60;
						clearInterval(codeTime);
						return;
					}
					$("#pushCode").html(_this.codeDelay);
				}, 1000);
			},
			login() { //登录或者注册
				if (!this.codeVerify() || !this.passwordVerify())
					return;
				let po = {
					"code": this.loginDate.password,
					"phone": this.loginDate.number
				}
				post("/sysuser/login", po, this);
			},
			passwordVerify() { //判断密码是否符合规范
				if (this.loginDate.password == "") {
					this.$message({
						message: '密码未填写',
						type: 'warning'
					});
					return false;
				}
				if (this.loginDate.loginType == 1 && this.loginDate.password.length != 5) {
					this.$message({
						message: '验证码格式不正确',
						type: 'warning'
					});
					return false;
				}
				return true;
			},
			codeVerify() { //判断账号是否符合规范
				if (this.loginDate.number == "") {
					this.$message({
						message: '账号未填写',
						type: 'warning'
					});
					return false;
				}
				if (this.loginDate.numberType == 1) {
					var regEmail = /^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/
					if (this.loginDate.number != '' && !regEmail.test(this.loginDate.number)) {
						this.$message({
							message: '邮箱格式不正确 请重新填写',
							type: 'warning'
						});
						return false;
					}
				} else {
					if (this.loginDate.number && (!(/^[1][34578]\d{9}$/).test(this.loginDate.number) || !(/^[1-9]\d*$/).test(this.loginDate.number) || this.loginDate.number.length !== 11)) {
						this.$message({
							message: '电话号码格式不正确 请重新填写',
							type: 'warning'
						});
						return false;
					}
				}
				return true;

			},
			numberTypeClick() { //切换登录方式 手机号/邮箱
				if (this.loginDate.numberType == 1) {
					this.loginDate.numberType = 0;
					this.numberType_icon = "el-icon-phone";
					this.$notify({
						title: '温馨提示',
						message: '你将账号设置了成手机号登录',
						position: 'top-left'
					});
				} else {
					this.loginDate.numberType = 1;
					this.numberType_icon = "el-icon-message";
					this.$notify({
						title: '温馨提示',
						message: '你将账号设置了成邮箱登录',
						position: 'top-left'
					});
				}
			},
			loginTypeClick() { //切换登录方式 密码/验证码
				if (this.loginDate.loginType == 1) {
					this.loginDate.loginType = 0;
					this.loginType_icon = "el-icon-lock";
					this.$notify({
						title: '温馨提示',
						message: '你设置了成密码登录',
						position: 'top-left'
					});
				} else {
					if (!this.codeVerify()) {
						return;
					}
					this.loginDate.loginType = 1;
					this.loginType_icon = "el-icon-tickets";
					this.$notify({
						title: '温馨提示',
						message: '你设置了成验证码登录',
						position: 'top-left'
					});
				}
			},
		},
		mounted() {
			let _this = this;
			//初始化时执行气球动画 循环12s/一次
			setInterval(function () {

				if (_this.balloon) {
					_this.balloonClick();
				}
			}, 15000);
		},
	});
</script>

</html>